from flask import Blueprint
from dependency_injector.wiring import Provide, inject

from .requests import SearchRequestModel
from ..converter import to_pydantic
from core.service import GetConnectionInfoService
from di.container import Container


api_blueprint = Blueprint('api', __name__, url_prefix='/api')


@api_blueprint.route('/search', methods=['GET'])
@to_pydantic()
@inject
def search(
        data: SearchRequestModel,
        service: GetConnectionInfoService = Provide[Container.elastic_service]
) -> str:
    package = data.package
    version = data.version
    res = service()
    print(res)
    return dict(res)
