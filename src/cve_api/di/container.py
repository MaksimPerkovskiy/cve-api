from dependency_injector.containers import DeclarativeContainer, WiringConfiguration
from dependency_injector import providers

from data_access.elasticsearch.connector import ElasticClient
from data_access.elasticsearch.repository import ElasticRepository
from core.service import GetConnectionInfoService


class Container(DeclarativeContainer):
    wiring_config = WiringConfiguration(packages=['presentation'])

    config = providers.Configuration(yaml_files=['config.yml'])

    elastic = providers.Resource(ElasticClient, connection_string=config.elastic.uri)

    elastic_repository = providers.Factory(ElasticRepository, client=elastic.provided.client)

    elastic_service = providers.Factory(GetConnectionInfoService, elastic_repo=elastic_repository)
